# Dockerfile simplificado para builds más rápidos
FROM node:22-slim

WORKDIR /app

# Copiar todo el código
COPY package*.json ./
COPY . .

# Instalar dependencias y construir
RUN npm ci --prefer-offline --no-audit && \
    npm run build && \
    npm ci --only=production --prefer-offline --no-audit && \
    npm cache clean --force

# Variables de entorno
ENV NODE_ENV=production
ENV PORT=3000
ENV HOST=0.0.0.0

# Exponer puerto
EXPOSE 3000

# Iniciar servidor
CMD ["node", "server/index.js"]
